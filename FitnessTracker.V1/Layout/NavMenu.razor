@using Microsoft.AspNetCore.Components
@inject AuthService AuthService

<ul class="list-group list-group-flush">

    <!-- HOME -->
    <li class="list-group-item">
        <NavLink class="text-decoration-none" href="" Match="NavLinkMatch.All">
            <i class="bi bi-house me-2"></i> Home
        </NavLink>
    </li>

    @if (role == "user")
    {
        <li class="list-group-item">
            <a class="d-flex justify-content-between align-items-center"
               data-bs-toggle="collapse" href="#userGrp">
                <span><i class="bi bi-person-circle me-2"></i> Utilisateur</span>
                <i class="bi bi-chevron-down small"></i>
            </a>
            <div class="collapse ms-4" id="userGrp">
                <NavLink class="d-block py-1" href="/analyse">Analyse</NavLink>
                <NavLink class="d-block py-1" href="/generate-programme">Générateur</NavLink>
                <NavLink class="d-block py-1" href="/view-session">Voir Séance</NavLink>
                <NavLink class="d-block py-1" href="/create-programme">Créer programme</NavLink>
            </div>
        </li>
    }

    @if (role == "admin" || role == "coach")
    {
        <li class="list-group-item">
            <a class="d-flex justify-content-between align-items-center"
               data-bs-toggle="collapse" href="#gestionGrp">
                <span><i class="bi bi-tools me-2"></i> Gestion</span>
                <i class="bi bi-chevron-down small"></i>
            </a>
            <div class="collapse ms-4" id="gestionGrp">
                <NavLink class="d-block py-1" href="/dashboard">Tableau de bord</NavLink>
                <NavLink class="d-block py-1" href="/Exercices">Exercices</NavLink>
                <NavLink class="d-block py-1" href="/gestion_poids">Poids</NavLink>
            </div>
        </li>
    }

    @if (role == "admin")
    {
        <li class="list-group-item">
            <a class="d-flex justify-content-between align-items-center"
               data-bs-toggle="collapse" href="#adminGrp">
                <span><i class="bi bi-shield-lock me-2"></i> Admin</span>
                <i class="bi bi-chevron-down small"></i>
            </a>
            <div class="collapse ms-4" id="adminGrp">
                <NavLink class="d-block py-1" href="/gestion-utilisateurs">Utilisateurs</NavLink>
            </div>
        </li>
    }

    <li class="list-group-item border-top">
        @if (AuthService.IsAuthenticated)
        {
            <NavLink class="text-danger text-decoration-none" href="/logout">
                <i class="bi bi-box-arrow-right me-2"></i> Déconnexion
            </NavLink>
        }
        else
        {
            <NavLink class="text-success text-decoration-none" href="/login">
                <i class="bi bi-box-arrow-in-right me-2"></i> Connexion
            </NavLink>
        }
    </li>
</ul>

@code {
    [Parameter] public string? CssClass { get; set; }
    private string role = "user";

    protected override async Task OnInitializedAsync()
        => role = await AuthService.GetCurrentUserRoleAsync();
}
